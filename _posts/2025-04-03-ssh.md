---
title: "SSH tricks to remember"
tags: ['ssh']
---

Last 6 months or so, I've been connecting a lot more via SSH then I used to.
There is a couple of things I learned that I want to remember. 
Here they are.

### Agent forwarding
The `-A` flag is useful if you ssh into a login node, and then want to ssh further into the network. When using passwordless authentication via SSH keys, the flag says that authentication requests should be forwarded, so that it is the "first" machine in the chain that is relevant. Lets say you connect 
```laptop --> server1 --> server2```
using the `-A` flag means that the keys on server1 are used to authenticate on server2. The corresponding key for the configuration file is `ForwardAgent yes`.

### SSH key adding
Just because your ssh keys lies in `~/.ssh` does not necessarily mean that they are added to the authentication agent. At least they weren't when I migrated from my windows machine to my macbook. Running `ssh-add` will add the keys to the agent, but it forgets between reboots. OSX has some special handling for this, and you might have to look at the most recent documentation, since they are changing it from time to time. One alternative is to include the `IdentityFile ~/.ssh/path/to/private/key` key to your `~/.ssh/config` file. Together with `AddKeysToAgent yes`, they circumvent the whole issue.

### Name expansion
The config file can contain wildcards. The host `b*` with hostname `foobar-%h` will make the command `ssh b100` expand into `ssh foobar-b100`. Very useful when there are many machines with similar names. Just create an entry in the config file like
```
Host b*
    HostName foobar-%h
```
What it really does is that it defines a pattern for a set of hostnames. Then it redefines the HostName for the connection string, so that it uses the host name `%h`, but this is the host name that was used when invoking ssh. So there is no clever pattern matching or regexes, just a simple substitution. See the heading `TOKEN` in the man page. The available tokens vary substantially between systems. What I see on my laptop with OpenSSH_9.8p1 is very different from the OpenSSH_7.4p1 on my server.

### Local Forwarding
The `-L` flag sets up tunnels. When I want to run a jupyter notebook on a remote server, port 8080 and tensorboard on port 6006, I can use flag  `-L8080:localhost:8080 -L 6006:localhost:6006`. When the connection is completed, I can open `localhost:8080`, and this will forward to `localhost:8080` on the remote machine. To set this via the config file instead, use the option `LocalForward`.

### More options
To read all the options for the `~/.ssh/config` file, check `man ssh_config`.